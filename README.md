# weixinProj
微信小程序(模拟收发单确认订单，签到抽奖短信注册等功能)  
制作过程中遇到的问题及解决方案之后会写在博客中......  
<img src="https://github.com/ChenMingK/weixinProj/blob/master/show.gif" width=40% height=40%/>

# 页面设计
## 整体样式
采用统一的深蓝色/蓝色作为顶部颜色和一些按钮和icon的颜色, 各个部分之间统一用浅灰色的线条来分隔

## 首页
首页分为轮播图, 搜索框, 发布的订单三个部分.<br>
调用云函数从数据库获取发布中的订单信息并渲染.

## 发单页面
发单页面整体为一个form表单, 通过textarea组件可以填写内容, 通过picker组件实现需要提供选项的表单信息.<br>
悬赏点数先从数据库读取, 使用slider组件实现, 最大值不超过当前用户所拥有的最大点数.<br>
点击“发布”将订单信息存入数据库且加入到当前用户所发布的订单中.

## 个人页面
个人页面提供签到和抽奖功能, 点击签到图标用户点数+1, 点击抽奖图标跳转到抽奖页面.<br>
点击“我发布的任务”和“我接受的任务”分别跳到对应的详情页面.

## 短信、抽奖
短信页面: 用户初次登录需要通过短信验证进行注册, 输入手机号后通过榛子云短信提供的API发送短信并验证.<br>
抽奖页面: 一个转盘, 点击“开始抽奖”后显示旋转动画, 取得对应的水滴点数并增加到用户数据上, 点击一次抽奖后便禁用按钮<br>
上方提供一个回到主页的text

# 逻辑设计
数据库表设计
1.users表：  _id（默认）_openid（默认） username（用户名） waterPoints(水滴数)
	   released_bills(发布的订单，数组，数组成员为订单id（String）)  
	   accepted_bills（接受的订单，同上）
2.bills表：_id  open_id  bill_id（订单id 保证唯一性）content（内容）extra（备注）tags（标签） publishDate（发布日期）publish_user（发单人） get_user（接单人（可无）） waterPoints（奖励水滴数）
state（待接收-onReceived，已接受-onProcessing，待审核-onCheckd）

触发条件：
1.用户登录（点开小程序）：若用户未在users表中（根据用户名判断），则加入到users表中，信息设置为默认数据
2.发单：用户填写完信息后，首先为该单生成一个唯一的id，然后users表released_bills数组中增加该id，然后bills表增加对应的所有信息
3.接单：触发接单操作后，users表get_bills数组增加相应信息，bills表对应id的记录信息改变（1.接单人 2.state ）
4.完成订单：接单人点击完成后需由发单人审核，审核通过接单人获取对应的水滴数，同时bills表中该id对应记录信息改变，users表中发单人和接单人水滴数都改变（通过username查询）。
5.显示信息：“me”页面需要读取该用户数据库中的发单、接单信息；
6.抽奖和签到：签到水滴数（inc命令）+  抽奖完成后水滴数（inc命令）
  
云函数设计：
1.register: 用于用户注册
2.hasRegistered: 检测是否已经注册
3.search: 根据标签进行搜索, 返回符合条件的bills
4.triggerFunc: 每日凌晨自动调用的云函数, 通过设置一个触发器实现, 用于重置用户的签到和抽奖的状态
# TODO
1.过期的订单仍能够接单
发单界面
1.任务发布后 发单时填写的 备注并不会出现（因此考虑是否有必要设置备注一栏）
2.服务类型里的代取物品 应该换为 代取送物品
3.第一次发单时没法划水滴。（有水滴的情况下）第二次可以<br>
"me"页面
1.发布后的任务不会在“我”页面的我发布的任务中出现
2.我接受的任务中也不会出现曾接受过的任务（或者是时有时无）
3.在确认了发布的任务之后水滴数凭空增加了45滴
4.点击了我发布的任务 之后会出现跳页情况（重复打开两次）.
5.点进去查看发布订单以后，退出来之后，订单界面就白屏了
6.签到可以无限次重复, 抽奖也出现这个问题(退出界面再进入就可以重复签到)
7.领到的水滴数没有在信息里及时更新
8.设置页面以及个人信息界面无法切入
9.可以无限次抽奖（单次进入小程序只可抽一次，但退出后重新进入仍可抽奖）
10.点击签到无效
11.建议发单时间可以自行设置
建议设置聊天界面或者提示用户联系方式 方便接单用户与发单者更好的对接

